stages:
- stage: Release
  # dependsOn: [ '' ]
  displayName: 'Release'
  jobs: 
  - job: CreateRelease
    displayName: 'Create release'
    pool:
      vmImage: 'windows-latest'
    steps:
    # - checkout: none
    - task: DownloadPipelineArtifact@2
      inputs:
        targetPath: $(Build.ArtifactStagingDirectory)
      displayName: 'Downloading artifacts'
    - task: Bash@3
      displayName: 'Getting next version number'
      inputs:
        targetType: 'inline'
        script: |
          patch_version=$(./latest-patch-version.sh)
          
          semantic_version_no=$(printf "%s.%s-%s" "$(Build.SourceBranchName)" "$patch_version" "$(version_no_env_segment)")
          echo "##vso[task.setvariable variable=semantic_version_no]$semantic_version_no"
          echo $semantic_version_no
    - task: Bash@3
      displayName: 'Echo semantic version number'
      inputs:
        targetType: 'inline'
        script: |
          echo "Semantic version number: $(semantic_version_no)"
    - task: GithubRelease@1 
      displayName: 'Creating GitHub Release'
      inputs:
        gitHubConnection: 'github.com_mpd-dawn'
        title: 'Growzen $(semantic_version_no)'
        repositoryName: '$(Build.Repository.Name)'
        tagSource: userSpecifiedTag
        tag: 'v$(semantic_version_no)'
        isPreRelease: $(is_pre_release)
        changeLogType: issueBased
        action: create
        assets: '$(Build.ArtifactStagingDirectory)/**/*'
